<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->

<head>
<meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<meta name="description" content="Name of your web site">
<meta name="author" content="Marketify">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>BambuMeta Demo | Home</title>

<!-- STYLES -->
<link href="https://fonts.googleapis.com/css2?family=Mulish:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Poppins:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="css/plugins.css" />
<link rel="stylesheet" type="text/css" href="css/colors.css" />
<link rel="stylesheet" type="text/css" href="css/style.css" />
<!--[if lt IE 9]> <script type="text/javascript" src="js/modernizr.custom.js"></script> <![endif]-->
<!-- /STYLES -->
<!-- jQuery should be loaded before your helper.js -->

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="js/handler.js"></script> <!-- defer ensures that the script runs after parsing -->
<!-- If you actually need modernizr, include it. -->
<script type="text/javascript" src="js/modernizr.custom.js"></script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-252875669-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-252875669-1');
</script>

</head>

<body> 
	<div class="overlay" id="overlay"></div>
	<!-- PRELOADER -->
	<div id="preloader">
		<div class="loader_line"></div>
	</div>
	<!-- /PRELOADER -->
	
<!-- WRAPPER ALL -->
<div class="shane_tm_all_wrap" data-magic-cursor="show" data-color="black">

	<!-- MAGIC CURSOR VALUES: "show", hide -->
	<!-- COLOR VALUES: blue, green, brown, pink, orange, black, white, purple, sky, cadetBlue, crimson, olive, red -->
	
	<!-- MOBILE MENU -->
	<div class="shane_tm_mobile_menu">
		<div class="topbar_inner">
			<div class="container bigger">
				<div class="topbar_in">
					<div class="logo">
						<a href="#"><img src="https://images.squarespace-cdn.com/content/v1/63ff448f8cb22765843dcff0/a793a91b-bb79-4b39-b3c5-8fb997c068f3/LOGO+bluegreen.png?format=1500w" alt="" /></a>
					</div>
					<div class="my_trigger">
						<div class="hamburger hamburger--collapse-r">
							<div class="hamburger-box">
								<div class="hamburger-inner"></div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="dropdown">
			<div class="container">
				<div class="dropdown_inner">
					<ul class="anchor_nav">
						<li class="current"><a href="#home">Home</a></li>
					<li><a href="#contact">Start Here</a></li>
					<li><a href="#portfolio">Industries</a></li>
					<li><a href="#portfolio">Platform</a></li>
						
					</ul>
				</div>
			</div>
		</div>
	</div>
	<!-- /MOBILE MENU -->
	
	<!-- TOPBAR -->
	<div class="shane_tm_topbar">
		<div class="topbar_inner">
			<div class="logo">
				<a href="#"><img src="https://images.squarespace-cdn.com/content/v1/63ff448f8cb22765843dcff0/a793a91b-bb79-4b39-b3c5-8fb997c068f3/LOGO+bluegreen.png?format=1500w" alt="" /></a>
			</div>
			<div class="menu">
				<ul class="anchor_nav">
					
					<li class="current"><a href="#home">Home</a></li>
					<li><a href="#contact">Start Here</a></li>
					<li><a href="#portfolio">Industries</a></li>
					<li><a href="https://app.bambumeta.software">Platform</a></li>
					
				</ul>
			</div>
		</div>
	</div>
	<!-- /TOPBAR -->
	
	<!-- HERO -->
	<div class="shane_tm_hero" id="home" data-style="one"> <!-- data-style values: one,two,three >> Empty is SQUARE shape -->
		<div class="background">
			<div class="image" data-img-url="https://images.prismic.io/smart-solutions/ddd989ed-2a43-4ebe-8cbd-c4ea7b791756_PhoneWithPasses.png?auto=compress,format"></div>
		</div>
		<div class="container">
			<div class="content">
				<div class="name_wrap"><h3><span>Bambu</span> Meta<span class="overlay_effect"></span></h3></div>
				<div class="job_wrap"><span class="job">Digital Engagement, Redefined.<span class="overlay_effect"></span></span></div>
			</div>
			<div class="shane_tm_down" data-skin="dark"> 
				<div class="line_wrapper">
					<div class="line"></div>
				</div>
			</div>
		</div>
	</div>
	<!-- /HERO -->

	<!-- TALK -->
	<div class="shane_tm_section" id="contact">
		<div class="shane_tm_talk">
			<div class="shape">
				<img class="svg" src="img/svg/paper.svg" alt="" />
			</div>
			
			<div class="background" id="talk">
				<a class="player" data-property="{videoURL:'https://www.youtube.com/watch?v=l6JN5M12BbE',containment:'#talk',autoPlay:true, loop:true, showControls:false, mute:true, startAt:0,opacity:1, quality:'default'}"></a>
				<div class="overlay"></div>
			</div>
			<div class="talk_inner">
				
				<div class="text wow fadeInUp" data-wow-duration="1.5s">
					<h3>Let's start here</h3>
				</div>
				<div class="button wow fadeInUp" data-wow-duration="1.5s">
					<a href="#" id="get-digital-card" onclick="openModal();">Get your digital card</a>
				</div>
				
				
				
			</div>
		</div>
	</div>
	<!-- /TALK -->
		
	<!-- PORTFOLIO -->
<div class="shane_tm_section" id="portfolio">
    <div class="shane_tm_portfolio">
        <div class="container">
            <div class="shane_tm_title">
                <div class="title_flex">
                    <div class="left">
                        <span>Use Cases</span>
                        <h3>Industries</h3>
                    </div>
                    <div class="portfolio_filter">
                        <ul>
                            <li><a href="#" class="current" data-filter="*">All</a></li>
                            <li><a href="#" data-filter=".marketing">Marketing</a></li>
                            <li><a href="#" data-filter=".messaging">Messaging</a></li>
                            <li><a href="#" data-filter=".vimeo">Order Notifications</a></li>
                            <li><a href="#" data-filter=".popup">Digital Receipt</a></li>
                            <li><a href="#" data-filter=".detail">Location Aware</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="shane_tm_portfolio_titles"></div>
            <div class="portfolio_list wow fadeInLeft" data-wow-duration="1.5s">
                <ul class="gallery_zoom">
					<li class="hospitality">
                        <div class="inner">
                            <div id="pop_overlay" style="display: none; position: fixed; top: 0; left: 0; height: 100%; width: 100%; background: rgba(0, 0, 0, 0.7); z-index: 999;"></div>
                            <div class="entry shane_tm_portfolio_animation_wrap" data-title="Activation" data-category="Hospitality" id="ActivationCardDiv">
                                <!-- Image to click to show the popup -->
                                <a href="javascript:void(0);" id="show-popup-btn">
									<img src="img/activation.png" alt="Show Popup" />
									
								</a>
								
								<div class="shane_tm_title">
									<div class="title_flex">
								<div class="left">
									<span>Activation</span>
								</div>
								</div>
								</div>
								
                                <!-- Mobile title -->
                                <div class="mobile_title">
                                    <h3>Hospitality</h3>
                                    <span>Activation</span>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="hospitality">
                        <div class="inner">
                            <div class="entry shane_tm_portfolio_animation_wrap" data-title="Reservations" data-category="Hospitality" id="ActivationCardDiv">
                                <!-- Image to click to show the popup -->
                                <a href="javascript:void(0);" id="show-popup-btn" onclick="showReservationPopup()">
									<img src="img/restaurant.png" alt="Show Popup" />
								</a>
								<div id="reservation_popUp" style="display:none; /* Other popup styles */">
									<!-- The content of the popup will be added dynamically via JS -->
								</div>
								<div class="shane_tm_title">
									<div class="title_flex">
								<div class="left">
									<span>Reservations</span>
								</div>
								</div>
								</div>
								
                                <!-- Mobile title -->
                                <div class="mobile_title">
                                    <h3>Hospitality</h3>
                                    <span>Activation</span>
                                </div>
                            </div>
                        </div>
                    </li>		
					<li class="hospitality">
                        <div class="inner">
                            <div class="entry shane_tm_portfolio_animation_wrap" data-title="Rewards" data-category="Hospitality" id="RewardsCardDiv">
                                <!-- Image to click to show the popup -->
                                <a href="javascript:void(0);" id="show-popup-btn" onclick="hospitalityRewardDemo()">
									<img src="img/hospitality_loyalty.png" alt="Show Popup" />
								</a>
								<div class="shane_tm_title">
									<div class="title_flex">
								<div class="left">
									<span>Rewards</span>
								</div>
								</div>
								</div>
								<div id="hospitalityRewardPopUp" style="display:none; /* Other popup styles */">
									<!-- The content of the popup will be added dynamically via JS -->
								</div>
                                <!-- Mobile title -->
                                <div class="mobile_title">
                                    <h3>Hospitality</h3>
                                    <span>Rewards</span>
                                </div>
                            </div>
                        </div>
                    </li>
					<li class="hospitality">
                        <div class="inner">
                            <div class="entry shane_tm_portfolio_animation_wrap" data-title="Messaging" data-category="Hospitality" id="MessageCardDiv">
                                <!-- Image to click to show the popup -->
                                <a href="javascript:void(0);" id="show-popup-btn" onclick="showHospitalityMessagePopup()">
									<img src="img/hospitality_message.png" alt="Show Popup" />
								</a>

								<div class="shane_tm_title">
									<div class="title_flex">
								<div class="left">
									<span>Messaging</span>
								</div>
								</div>
								</div>
								<div id="hospitality_message_popup" style="display:none;">
								</div>
                                <!-- Mobile title -->
                                <div class="mobile_title">
                                    <h3>Hospitality</h3>
                                    <span>Messaging</span>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="hospitality">
                        <div class="inner">
                            <div class="entry shane_tm_portfolio_animation_wrap" data-title="Location" data-category="Hospitality" id="LocationCardDiv">
                                <!-- Image to click to show the popup -->
                                <a href="javascript:void(0);" id="show-popup-btn" onclick="showHospitalityMessagePopup()">
									<img src="img/hospitality_location.png" alt="Show Popup" />
								</a>		
								<div class="shane_tm_title">
									<div class="title_flex">
								<div class="left">
									<span>Location</span>
								</div>
								</div>
								</div>
								
                                <!-- Mobile title -->
                                <div class="mobile_title">
                                    <h3>Hospitality</h3>
                                    <span>Location</span>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="hospitality">
                        <div class="inner">
                            <div class="entry shane_tm_portfolio_animation_wrap" data-title="Payments" data-category="Hospitality" id="PaymentsCardDiv">
                                <!-- Image to click to show the popup -->
                                <a href="javascript:void(0);" id="show-popup-btn" onclick="showHospitalityMessagePopup()">
									<img src="img/hospitality_payment.png" alt="Show Popup" />
								</a>
								<div class="shane_tm_title">
									<div class="title_flex">
								<div class="left">
									<span>Payments</span>
								</div>
								</div>
								</div>
								
                                <!-- Mobile title -->
                                <div class="mobile_title">
                                    <h3>Hospitality</h3>
                                    <span>Payments</span>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- /PORTFOLIO -->

	<!-- SKILLS -->
	<div class="shane_tm_section">
		<div class="shane_tm_skills">
			<div class="container">
				<div class="skills_inner">
					<div class="left wow fadeInLeft" data-wow-duration="1.5s">
						<div class="shane_tm_title">
							<h3>Something marketing</h3>
						</div>
						<div class="text">
							<p>xxxxxxx</p>
						</div>
					</div>
					<div class="right wow fadeInLeft" data-wow-duration="1.5s" data-wow-delay=".2s">
						<div class="tokyo_progress">
							<div class="progress_inner" data-value="95">
								<span><span class="label">something</span><span class="number">95%</span></span>
								<div class="background"><div class="bar"><div class="bar_in"></div></div></div>
							</div>
							<div class="progress_inner" data-value="80" >
								<span><span class="label">something</span><span class="number">80%</span></span>
								<div class="background"><div class="bar"><div class="bar_in"></div></div></div>
							</div>
							<div class="progress_inner" data-value="90">
								<span><span class="label">something</span><span class="number">90%</span></span>
								<div class="background"><div class="bar"><div class="bar_in"></div></div></div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- /SKILLS -->
	<!-- VIDEO -->
	<div class="shane_tm_section">
		<div class="shane_tm_business_video">
			<div class="bg">
				<div class="image jarallax" data-speed="0" data-img-url="img/slider/4.jpg"></div>
				<div class="overlay"></div>
			</div>
			<div class="content">
				<span class="rounded"><a class="popup-youtube" href="https://www.youtube.com/watch?v=iIrSCm_0Sj4"></a></span>
				<h3 class="text wow fadeInUp" data-wow-duration="1.5s">Murphy Video</h3>
				<div class="shane_tm_video_button wow fadeInUp" data-wow-duration="1.5s">
					<a class="popup-youtube" href="https://www.youtube.com/watch?v=ICr_bOuM9Zo">Watch Demo</a>
				</div>
			</div>
		</div>
	</div>
	<!-- /VIDEO -->



<!-- MODAL CONTACT -->
<div class="custom-modal" id="myModal">
    <div class="custom-modal-content">
        <div class="wrapper">
            <span class="custom-close" onclick="closeModal()">&times;</span>
            <div class="wizard">
                <!-- Step 1: Tell us about yourself -->
                <div class="step" id="step1">
                    <div class="contact_title" style="margin-bottom: 20px;">
                        <h4 style="color: #000; font-weight: bold;">1. Tell us about yourself</h4>
                    </div>
                    <div class="fields">
                        <form id="contact_form" autocomplete="off">
                            <div class="returnmessage" data-success="Your message has been received, We will contact you soon."></div>
                            <div class="first">
                                <ul style="list-style-type: none; padding: 0;">
                                    <li style="margin-bottom: 15px;"><input id="first_name" name="first_name" type="text" placeholder="First Name" onkeyup="updateOverlayText(this.value); checkFormAndSelector();"></li>
                                    <li style="margin-bottom: 15px;"><input id="last_name" name="last_name" type="text" placeholder="Last Name" onkeyup="updateOverlayText(); checkFormAndSelector();"></li>
                                    <li style="margin-bottom: 15px;"><input id="email" name="email" type="text" placeholder="Email" onkeyup="checkFormAndSelector();"></li>
                                    <li><input id="company" name="company" type="text" placeholder="company"></li>
                                </ul>
                            </div>
                        </form>
                    </div>
                </div>
                <!-- Step 2: Preview your card -->
                <div class="step hidden" id="step2">
                    <div class="contact_title" style="margin-bottom: 20px;">
                        <h4 style="color: #000; font-weight: bold;">2. Choose your card</h4>
                    </div>
                    <div class="modal-image">
                        <img src="img/base_card.png" alt="Descriptive alt text" id="selectedImage">
                        <div class="new_overlay-text" id="overlayText"></div>
                    </div>
                    <div class="selector-container" style="margin-top: 20px;">
                        <select id="cardSelector" onchange="updateImage(this.value);" style="padding: 10px; width: 100%; border: 1px solid #ccc; border-radius: 4px;">
                            <option value="none">Choose your industry</option>
                            <option value="retail">Retail</option>
                            <option value="cpg">CPG</option>
                            <option value="insurance">Insurance</option>
                            <option value="sport">Sports</option>
                            <option value="hospitality">Hospitality</option>
                        </select>
                    </div>
                </div>
                
				
				
				<!-- Wizard Controls -->
				<div class="wizard-controls" style="margin-top: 20px;">
					<a href="#" style="background-color: #000; border: none; color: white; padding: 12px 24px; text-align: center; text-decoration: none; font-size: 16px; margin: 4px 2px; cursor: pointer; border-radius: 4px; transition: background-color 0.3s;" onclick="previousStep(); return false;">Previous</a>
					<a href="#" class="next-btn" style="background-color: #000; border: none; color: white; padding: 12px 24px; text-align: center; text-decoration: none; font-size: 16px; margin: 4px 2px; cursor: pointer; border-radius: 4px; transition: background-color 0.3s;" onclick="nextStep(); return false;">Next</a>
					<a href="#" class="next-btn" style="background-color: #000; border: none; color: white; padding: 12px 24px; text-align: center; text-decoration: none; font-size: 16px; margin: 4px 2px; cursor: pointer; border-radius: 4px; transition: background-color 0.3s; display: none;" onclick="downloadCard();" id="downloadCardButton">Download card</a>
					<a id="send_message" href="#" style="background-color: #000; border: none; color: white; padding: 12px 24px; text-align: center; text-decoration: none; font-size: 16px; margin: 4px 2px; cursor: pointer; border-radius: 4px; transition: background-color 0.3s; display: none;" onclick="initiateCreateCardProcess();" disabled style="display: block; text-align: center;">Create card</a>

				</div>
				
			
    </div>
</div>

<!-- END MODAL CONTACT -->


<style>
    .popup_description_wrap {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
    }

    /* Container */
.modal-image {
    position: relative;   /* set relative positioning on container */
    display: inline-block; /* keeps the width of the container as wide as the image */
}

/* Image */
.modal-image img {
    display: block;   /* removes any extra space around the image */
    max-width: 100%;  /* optional, ensures image doesn't overflow container */
}

/* Overlay text */
.new_overlay-text {
	top: 50%;
    position: absolute;   /* absolutely position the text within the container */
    bottom: 10px;         /* position the text 10px from the bottom of the container */
    left: 45px;           /* position the text 10px from the left of the container */
   
    color: black;         /* white text */
    padding: 5px 10px;    /* padding around the text */
    border-radius: 3px;
	font-size: 10px;   /* optional, rounded corners for the overlay background */
}


    .left {
        flex: 1;
        margin-right: 20px;  /* Add space to the right of the form */
    }

    /* Mobile View */
    @media (max-width: 768px) {
        .popup_description_wrap {
            flex-direction: column;
        }

        .modal-image, .left {
            width: 100%;
        }

        .left {
            margin-right: 0; /* Reset the margin for mobile */
        }
    }
</style>

	<!-- CURSOR -->
	<div class="mouse-cursor cursor-outer"></div>
    <div class="mouse-cursor cursor-inner"></div>
	<!-- /CURSOR -->
	
	<!-- TOTOP -->
	<div class="progressbar">
		<a href="#"><span class="text">To Top</span></a>
		<span class="line"></span>
	</div>
	<!-- /TOTOP -->
	
</div>



  
<!-- SCRIPTS -->
<!--[if lt IE 10]> <script type="text/javascript" src="js/ie8.js"></script> <![endif]-->	
<script src="js/plugins.js"></script> 
<script src="js/init.js"></script>
<script defer>
	document.addEventListener("DOMContentLoaded", function() {
    console.log("Clearing session storage...");
    sessionStorage.clear();
	const defaultIndustry = document.querySelector("#cardSelector").value;
    updateFilterMenu(defaultIndustry);
});

cardSelector.addEventListener('change', function() {
        const selectedValue = this.value;
        sessionStorage.setItem('selectedIndustry', selectedValue);
});
const industryFilters = {
    hospitality: [
        { label: 'Reservations', filter: '.hospitality' },
        { label: 'Rewards', filter: '.hospitality' },
		{ label: 'Messaging', filter: '.hospitality'},
		{ label: 'Location Aware', filter: '.hospitality'},
        { label: 'Payments', filter: '.hospitality'}
    ],
    // Add other industries as needed...
    default: [
        { label: 'Retail', filter: '.retail' },
        { label: 'CPG', filter: '.CPG' },
        { label: 'Insurance', filter: '.insurance'},
        { label: 'Sports', filter: '.Sports' },
		{ label: 'Hospitality', filter: '.hospitality'}
    ]
};

function updateFilterMenu(selectedIndustry) {
    const filterMenu = document.querySelector(".portfolio_filter ul");
    const filters = [{ label: 'All', filter: '*' }].concat(industryFilters[selectedIndustry] || industryFilters.default);

    filterMenu.innerHTML = filters.map(item => `<li><a href="#" data-filter="${item.filter}">${item.label}</a></li>`).join('');

    // If you need to reattach event listeners to these new elements, do it here.

    applyFilter(filters[0].filter);  // Apply the first filter by default
}

document.querySelector("#cardSelector").addEventListener("change", function() {
    updateFilterMenu(this.value);
});

function applyFilter(filterValue) {
    let portfolioList = document.querySelector(".portfolio_list ul");

    // If filter is for "All", show all the image options
    if (filterValue === "*") {
        for (let item of portfolioList.children) {
            item.style.display = "block";
        }
    } else {
        // Hide all image options
        for (let item of portfolioList.children) {
            item.style.display = "none";
        }

        // Display only the ones that correspond to the clicked filter category
        let filteredItems = portfolioList.querySelectorAll(filterValue);
        for (let item of filteredItems) {
            item.style.display = "block";
        }
    }
}

document.querySelector(".portfolio_filter ul").addEventListener("click", function(e) {
    e.preventDefault();
    if (e.target.tagName === "A") {
        // Remove 'current' class from all menu items
        for (let li of this.children) {
            li.querySelector('a').classList.remove("current");
        }
        // Add 'current' class to clicked menu item
        e.target.classList.add("current");

        let filterValue = e.target.getAttribute("data-filter");
        applyFilter(filterValue);
    }
});


	// Your JavaScript here
/**
 * Makes an API call to issue a wallet.
 * 
 * @param {string} accessToken - The access token to use for authentication.
 * @param {string} firstName - The first name of the person.
 * @param {string} lastName - The last name of the person.
 * @param {string} email - The email address of the person.
 * @param {Object} customData - Any additional data to send with the request.
 * @param {Function} [onSuccess] - An optional callback to execute on a successful API call.
 */
var currentStep = 1;
function makeIssueWalletApiCall(accessToken, firstName, lastName, email, company, customData, onSuccess) {
    console.log("makeIssueWalletApiCall started");

    const urlParams = new URLSearchParams(window.location.search);
    const sellerValue = urlParams.get('seller') || "defaultSeller";

    var emailFromSession = sessionStorage.getItem('email');
    var issueWalletEndpoint = 'https://sandbox.api.bambumeta.software/brands/9/programs/265/issue-wallet?email=' + encodeURIComponent(emailFromSession);

    var apiHeaders = {
        Authorization: 'Bearer ' + accessToken
    };

    var issueWalletData = {
        brandId: 9,
        programId: 265,
        templateId: 180,
		templateTierId: customData && customData.templateTierId ? customData.templateTierId : "",
        person: {
            firstName: firstName,
            lastName: lastName,
            email: email,
            company: company
        },
        passdata: {
            metaData: {
                seller: sellerValue
            }
        },
        ...customData  // Spread in custom data if any
    };

    console.log('Constructed issueWalletData:', issueWalletData);

    $.ajax({
        url: getProxyURL(issueWalletEndpoint),
        method: 'POST',
        headers: apiHeaders,
        data: JSON.stringify(issueWalletData),
        contentType: 'application/json',
        success: function(issueWalletResponse) {
            console.log('Success handler triggered:', issueWalletResponse);

            if (issueWalletResponse.passId || issueWalletResponse.personId) {
                sessionStorage.setItem("passId", issueWalletResponse.passId);
                sessionStorage.setItem("personId", issueWalletResponse.personId);

                if (issueWalletResponse.downloadUrl) {
                    sessionStorage.setItem("downloadUrl", issueWalletResponse.downloadUrl);
                }

                if (typeof onSuccess === 'function') {
                    console.log("onSuccess callback found, invoking it now.");
                    onSuccess();
                } else {
                    console.log("onSuccess callback not provided or not a function");
                }
                if (customData && customData.currentMessage) {
                 issueWalletData.currentMessage = customData.currentMessage;
                delete customData.currentMessage;  // remove it from customData
                }
                issueWalletData = {
                ...issueWalletData,  // Spread in the existing data 
                ...customData  // Spread in custom data if any
                };

            } else {
                console.log("issueWalletResponse does not contain passId and/or personId");
            }
        },
        error: function(error) {
            console.log('Error handler triggered:', error);
        }
    });
}

// Get all input fields from step 1
const step1Inputs = document.querySelectorAll('#step1 input');
function showReservationPopup() {
    const initialContent = `
        <div style="background-color: #fff; max-width: 600px; height: auto; margin: auto; padding: 20px; position: relative; border-radius: 10px; box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5); z-index: 2000;">
            <span onclick="hideReservationPopUp()" style="position: absolute; top: 10px; right: 10px; cursor: pointer; font-size: 24px; z-index: 2001;">&times;</span>
            <button onclick="reservationDemo()" style="display: block; width: 170px; margin: 20px auto; background-color: #000; border: none; color: white; padding: 12px 24px; text-align: center; text-decoration: none; font-size: 16px; border-radius: 4px; transition: background-color 0.3s;">Start Demo</button>
        </div>
    `;

    // Set the content and display the popup
    document.getElementById('reservation_popUp').innerHTML = initialContent;
    document.getElementById('pop_overlay').style.display = 'block';
    document.getElementById('reservation_popUp').style.display = 'block';
}

function hideReservationPopUp() {
    document.getElementById('pop_overlay').style.display = 'none';
    document.getElementById('reservation_popUp').style.display = 'none';
}



function closeMarketingPopup() {
    var popup = document.getElementById('marketingPopup');
	var overlay = document.getElementById('pop_overlay');
    popup.style.display = 'none';
	overlay.style.display = "none";
}

function cardReservation() {
    console.log('cardReservation function called');

    // Retrieve the values from sessionStorage
    var storedFirstName = sessionStorage.getItem('firs_name');
    var storedLastName = sessionStorage.getItem('last_name');
    var storedEmail = sessionStorage.getItem('email');

    // Debugging: Log the values
    console.log('Stored values:', storedFirstName, storedLastName, storedEmail);

    obtainToken((accessToken) => {
        // Modify the body for the makeIssueWalletApiCall and call it
        let customData = {
            templateTierId: 115
        };

        // Define the onSuccess callback
        function updatePopup() {
            console.log("Updating marketing popup content after successful API call");
    
            // Target the correct popup element using jQuery for consistency
            $('#marketingPopup').html(`
                <div style="width: 50%; float: left;">
                    <h2>Card Update</h2>
                    <p>Your card is now updated.</p>
                </div>
                <div style="width: 50%; float: right;">
                    <img src="img/hospitality_base.png" alt="Popup Image" style="max-width: 100%;">
                </div>
                <div style="clear: both;"></div>
                <div>
                    <button style="background-color: #000; border: none; color: white; padding: 12px 24px; text-align: center; text-decoration: none; font-size: 16px; margin: 4px 2px; cursor: pointer; border-radius: 4px; transition: background-color 0.3s;" onclick="closePopup()">OK</button>
                </div>
            `);
        }

        // Now call the API function with the callback
        makeIssueWalletApiCall(accessToken, storedFirstName, storedLastName, storedEmail, customData, updatePopup);
    });
}

function closePopup() {
    $('#marketingPopup').hide();
	$('#pop_overlay').hide();
}




function hideSpinner() {
    var spinner = document.getElementById("spinnerModal");
    spinner.style.display = "none";
}
function showMessageModal() {
    var modal = document.getElementById("messageModal");
    modal.style.display = "block";
}
function updateOverlayText() {
    var firstName = document.getElementById('first_name').value;
    var lastName = document.getElementById('last_name').value;
    var combinedName = (firstName + " " + lastName).trim();
    
    var overlay = document.getElementById('overlayText');
    overlay.textContent = combinedName ? combinedName : "Your Text Here";
}
function downloadCard() {
    const downloadButton = document.getElementById("downloadCardButton");
    const downloadUrl = 'https://wallet-pass-sandbox.bambumeta.software' + sessionStorage.getItem("downloadUrl");
    downloadButton.href = downloadUrl;
    downloadButton.target = "_blank";
    downloadButton.click();
}
function generateRandomNumber() {
    // This will generate a random number between 100000 and 999999. Adjust as needed.
    return Math.floor(Math.random() * (999999 - 100000 + 1)) + 100000;
}

function initiateCreateCardProcess() {
    // First, fetch the token.
    obtainToken(function(accessToken) {
        if (accessToken) {
            // Now, retrieve form values.
            const firstName = document.getElementById("first_name").value;
            const lastName = document.getElementById("last_name").value;
            const email = document.getElementById("email").value;
            const company = document.getElementById("company").value;

            // Get the selected industry
            const industry = document.getElementById('cardSelector').value;
            let templateTierId;
            switch (industry) {
                case "retail":
                    templateTierId = 100;
                    break;
                case "hospitality":
                    templateTierId = 130;
                    break;
                case "cpg":
                    // assign the appropriate templateTierId for CPG
                    break;
                case "insurance":
                    // assign the appropriate templateTierId for Insurance
                    break;
                case "sport":
                    // assign the appropriate templateTierId for Sports
                    break;
                // ... add more cases for other industries if needed
                default:
                    console.error('Invalid industry selected.');
                    return;
            }
			const hospitality_loyalty = generateRandomNumber();
            // Store values in the session storage
            sessionStorage.setItem("email", email);
            sessionStorage.setItem('first_name', firstName);
            sessionStorage.setItem('last_name', lastName);
            sessionStorage.setItem('company', company);

            // Custom data with templateTierId
			const customData = {
                templateTierId: templateTierId,
                passdata: {
                    metaData: {
                        loyaltyAccount: hospitality_loyalty.toString()  // Convert to string if needed
                    }
                }
            };

            // Define the onSuccess callback
            function handleSuccess() {
                console.log('Card created successfully from initiateCreateCardProcess');
                
                // Hide Next and Previous buttons, the "Create card" button and show the "Download card" button.
                $('a[onclick="previousStep(); return false;"]').hide();
                $('a[onclick="nextStep(); return false;"]').hide();
                $('#downloadCardButton').show();
                $('#send_message').hide();  // Hide the "Create card" button
            }

            // Call makeIssueWalletApiCall with the necessary values, customData, and the onSuccess callback
            makeIssueWalletApiCall(accessToken, firstName, lastName, email, company, customData, handleSuccess);
            saveToGoogleSheets(firstName, lastName, email, company, industry, hospitality_loyalty);
        } else {
            console.log('Failed to fetch the access token.');
        }
    });
}


function addRecordToHubSpot(firstName, lastName, email, phone, company, website) {
    const hubSpotURL = "https://api.hubapi.com/crm/v3/objects/contacts/batch/create";
    const bearerToken = "pat-na1-7f6cdc57-a7d9-427c-bd08-a2af4f399b59";  // Replace with your actual token.

    const data = {
        inputs: [
            {
                properties: {
                    email: email,
                    phone: phone,
                    company: company,
                    website: website,
                    lastname: lastName,
                    firstname: firstName
                    
                },
                associations: []
            }
        ]
    };

    // Fetch using the proxy URL
    fetch(getProxyURL(hubSpotURL), {
        method: "POST",
        body: JSON.stringify(data),
        headers: {
            "Accept": "application/json",
            "Content-Type": "application/json",
            "Authorization": `Bearer ${bearerToken}`
        }
    })
    .then(response => response.json())
    .then(data => {
        console.log("Success:", data);
    })
    .catch((error) => {
        console.error("Error:", error);
    });
}
function getProxyURL(targetURL) {
    const baseURL = 'https://bambu-cors-9374b174ef1e.herokuapp.com/proxy?url=';
    return baseURL + encodeURIComponent(targetURL);
}
function showSpinner() {
    var spinner = document.getElementById("spinnerModal");
    console.log(spinner); // Log the value here
    spinner.style.display = "block";
}
function updateImage(category) {
    var imageUrl = "";
    var overlayText = "";
    switch(category) {
        case 'retail':
            imageUrl = "img/demo_card.png";
            overlayText = "Tye your name on the form";
            break;
        case 'cpg':
            imageUrl = "https://via.placeholder.com/150?text=Messaging";
            overlayText = "Messaging Details";
            break;
        case 'insurance':
            imageUrl = "https://via.placeholder.com/150?text=Order+Notifications";
            overlayText = "Order Notification Info";
            break;
        case 'sport':
            imageUrl = "https://via.placeholder.com/150?text=Digital+Receipt";
            overlayText = "Digital Receipt Overview";
            break;
        case 'hospitality':
            imageUrl = "img/hospitality_base.png";
            overlayText = "xxxxxx";
            break;
    }
    checkFormAndSelector();
    var imageElement = document.getElementById('selectedImage');
    var textElement = document.getElementById('overlayText');
    
    imageElement.src = imageUrl;
    textElement.textContent = overlayText;
}
function checkFormAndSelector() {
    let firstName = document.getElementById('first_name').value;
    let lastName = document.getElementById('last_name').value;
    let email = document.getElementById('email').value;
    let imageSelected = document.getElementById('selectedImage').src;
  
    let defaultImage = "path_to_your_default_image"; // replace with your default image path

    let button = document.getElementById('send_message');

    if(firstName && lastName && email && imageSelected !== defaultImage) {
        button.removeAttribute('disabled');
    } else {
        button.setAttribute('disabled', 'true');
    }
}
function obtainToken(callback) {
    const authUrl = 'https://sandbox-auth.bambumeta.software/oauth2/token';
    const tokenData = {
        grant_type: 'client_credentials'
    };
    const tokenHeaders = {
        'Content-Type': 'application/x-www-form-urlencoded',
        Authorization: 'Basic ' + btoa('4mml4rs040gcmknikh8eg6170q' + ':' + '9381m4jhqji7eir2nmpg9fph0aj2bsu1j508mrc3e57aar99727')
    };

    $.ajax({
        url: authUrl,
        method: 'POST',
        headers: tokenHeaders,
        data: tokenData,
        success: function(tokenResponse) {
            const accessToken = tokenResponse.access_token;

            // Store the token and expiration time in sessionStorage
            const currentTime = new Date().getTime();  // Current time in milliseconds
            const expiresAt = currentTime + (tokenResponse.expires_in * 1000);  // Expiration time in milliseconds

            sessionStorage.setItem('bearerToken', accessToken);
            sessionStorage.setItem('tokenExpiresAt', expiresAt.toString());

            console.log('Generated token:', accessToken);
            if (typeof callback === 'function') callback(accessToken);
        },
        error: function(error) {
            console.log('Failed to obtain bearer token', error);
            document.querySelector('.spinner_container').style.display = 'none';  // Hide the spinner
        }
    });
}
function isTokenValid() {
    const currentTime = new Date().getTime();
    const expiresAt = Number(sessionStorage.getItem('tokenExpiresAt') || 0);
    return currentTime < expiresAt;
}

function openModal() {
    document.getElementById('myModal').style.display = 'block';
}

function nextStep() {
    console.log("nextStep called. Current step:", currentStep);

    // Increment the step
    if (currentStep < 2) {
        currentStep++;
        console.log("Incrementing step to: ", currentStep);
        showStep(currentStep);
        
        // If you're on step 2
        if (currentStep === 2) {
            document.querySelector(".wizard-controls .next-btn").style.display = "none";
            document.getElementById("send_message").style.display = "block";
        } else { 
            // If you're on any other step (like step 1)
            document.querySelector(".wizard-controls .next-btn").style.display = "block";
            document.getElementById("send_message").style.display = "none";
        }
    } else {
        console.log("Cannot increment step further.");
    }
}

function showStep(step) {
    // Grab all steps
    console.log("Attempting to show step: ", step);
    const steps = document.querySelectorAll('.wizard .step');
    
    // Hide all of them
    for (let s of steps) {
        s.style.display = 'none';  
    }
    
    // Show the specified step
    document.querySelector('#step' + step).style.display = 'block'; 
}
function previousStep() {
    console.log("previousStep called. Current step:", currentStep);

    // Decrement the step
    if (currentStep > 1) {
        currentStep--;
        console.log("Decrementing step to: ", currentStep);
        showStep(currentStep);

        // If you're moving back to step 1
        if (currentStep === 1) {
            document.querySelector(".wizard-controls .next-btn").style.display = "block";
            document.getElementById("send_message").style.display = "none";
        }
    } else {
        console.log("Cannot decrement step further.");
    }
}

function closeModal() {
    // Close the myModal
    var myModal = document.getElementById("myModal");
    if (myModal) { 
        myModal.style.display = "none";
    }

    // Close the .shane_tm_modalbox
    var shaneModal = document.querySelector(".shane_tm_modalbox");
    if (shaneModal) { 
        shaneModal.style.display = "none";
    }
}



	const buttons = document.querySelectorAll('.selector-button');
	const selectedImage = document.getElementById('selectedImage');

	buttons.forEach(button => {
		button.addEventListener('click', function() {
			const imageUrl = this.getAttribute('data-image');
			selectedImage.src = imageUrl;
		});
	});
	function reservationDemo() {
    var reservationPopupElement = document.getElementById('reservation_popUp');

    // Check if the element exists
    if (reservationPopupElement !== null) {
        var formContent = `
        <div style="background-color: #fff; max-width: 600px; height: auto; margin: auto; padding: 20px; position: relative; border-radius: 10px; box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5); z-index: 2000;">
            <!-- Close button -->
            <span onclick="hideReservationPopUp()" style="position: absolute; top: 10px; right: 10px; cursor: pointer; font-size: 24px; color: #555; z-index: 2001;">&times;</span>

            <h2 style="text-align: center; margin-bottom: 20px; color: #333;">Reservation Form</h2>
            
            <div class="selector-container" style="margin-bottom: 16px;">
                <select id="restaurantDropdown" style="padding: 10px; width: 100%; border: 1px solid #ccc; border-radius: 4px;">
                    <option value="restaurantA">Restaurant A</option>
                    <option value="restaurantB">Restaurant B</option>
                    <!-- ... -->
                </select>
            </div>

            <label style="display: block; margin-bottom: 8px;">Reservation Date:</label>
            <input type="date" id="reservationDate" style="width: 100%; padding: 10px; margin-bottom: 16px; border: 1px solid #aaa; border-radius: 4px;">

            <label style="display: block; margin-bottom: 8px;">Number of People:</label>
            <input type="text" id="numOfPeople" style="width: 100%; padding: 10px; margin-bottom: 16px; border: 1px solid #aaa; border-radius: 4px;">

            <button onclick="submitReservation()" style="display: block; width: 200px; margin: 20px auto; background-color: #000; border: none; color: white; padding: 12px 24px; text-align: center; text-decoration: none; font-size: 16px; border-radius: 4px; transition: background-color 0.3s;">Submit Reservation</button>
        </div>
        `;

        reservationPopupElement.innerHTML = formContent;
    } else {
        console.error('Element with ID "reservation_popUp" not found.');
    }
}


function formatDateToMMDDYY(inputDate) {
    const date = new Date(inputDate);
    const day = String(date.getDate()).padStart(2, '0');
    const month = String(date.getMonth() + 1).padStart(2, '0'); // Months are zero-based
    const year = String(date.getFullYear()).slice(-2); // Get the last 2 characters of the year

    return `${month}/${day}/${year}`;
}

function submitReservation() {
    var restaurant = document.getElementById('restaurantDropdown').value;
    var reservationDate = document.getElementById('reservationDate').value;
    var headcount = document.getElementById('numOfPeople').value;

    // Format the reservation date to MM/DD/YY
    var formattedReservationDate = formatDateToMMDDYY(reservationDate);

    // Retrieve values from sessionStorage
    var email = sessionStorage.getItem('email');
    var first_name = sessionStorage.getItem('first_name');
    var last_name = sessionStorage.getItem('last_name');
    var company = sessionStorage.getItem('company');

    obtainToken((accessToken) => {
        let issueWalletData = {
            brandId: 9,
            programId: 265,
            templateId: 180,
			templateTierId: 115,
            person: {
                first_name: first_name,
                last_name: last_name,
                email: email,
                company: company
            },
            passdata: {
                metaData: {
                    reservationDate: formattedReservationDate,
                    headcount: headcount
                }
            }
        };

        console.log('Constructed issueWalletData for Reservation:', issueWalletData);

        // Calling the makeIssueWalletApiCall with the appropriate arguments
        makeIssueWalletApiCall(accessToken, first_name, last_name, email, company, issueWalletData, (response, error) => {
            if (error) {
                console.error("There was an error:", error);
                // Show some error message to the user, maybe update the DOM or show a popup
            } else {
                console.log("API call successful. Response:", response);
                var popupContent = `
                <h2>Success!</h2>
                <p>Check your wallet card to see the changes.</p>
                <button onclick="closeMarketingPopup();" style="display: block; width: 200px; margin: 20px auto; background-color: #000; border: none; color: white; padding: 12px 24px; text-align: center; text-decoration: none; font-size: 16px; border-radius: 4px; transition: background-color 0.3s;">OK</button>
                `;

                document.getElementById('marketingPopup').innerHTML = popupContent;
            }
        });
    });
}


function showHospitalityRewardPopUp() {
    var popup = document.getElementById('hospitalityRewardPopUp');
    popup.style.display = 'block';
}

function hideHospitalityRewardPopUp() {
    var popup = document.getElementById('hospitalityRewardPopUp');
    popup.style.display = 'none';
}
function hideHospitalityMessagePopUp() {
    var popup = document.getElementById('hospitality_message_popup');
    popup.style.display = 'none';
}

function hospitalityRewardDemo() {
    // Initial content with the Start Demo button
	var initialContent = `
        <div class="content">
			<span class="close-btn" onclick="hideHospitalityRewardPopUp()" style="position: absolute; top: 10px; right: 10px; cursor: pointer; font-size: 24px;">&times;</span>
            <img src="img/hospitality_rewards_slide.png" alt="Hospitality Rewards" style="max-width: 100%; width: auto; height: auto; display: block; margin: 20px auto;">
            <p>Some description for the demo...</p>
            <button onclick="startRewardContent()" style="display: block; width: 170px; margin: 20px auto; background-color: #000; border: none; color: white; padding: 12px 24px; text-align: center; text-decoration: none; font-size: 16px; border-radius: 4px; transition: background-color 0.3s;">Start Demo</button>
        </div>
`;


    // Set the content and display the popup
    document.getElementById('hospitalityRewardPopUp').innerHTML = initialContent;
    showHospitalityRewardPopUp(); 
}

function startRewardContent() {
    var reward_PopupElement = document.getElementById('hospitalityRewardPopUp');
    var demoContent = `
        <div style="background-color: #fff; max-width: 600px; height: 500px; margin: auto; padding: 20px; position: relative; border-radius: 10px; box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5); overflow-y: auto;">
            <span class="close-btn" onclick="hideHospitalityRewardPopUp()" style="position: absolute; top: 10px; right: 10px; cursor: pointer; font-size: 24px;">&times;</span>
            <h2>Demo Started</h2>
            <p>More details and interactions...</p>
            <div class="selector-container">
                <select id="rewardSelection">
                    <option value="0">Choose Reward</option>
                    <option value="1">Taco Tuesday Meal</option>
                    <option value="2">Bacardi Drink</option>
                    <option value="3">Dinner over $50.00</option>
                    <option value="4">Dessert with dinner</option>
                </select>
            </div>
            <button onclick="issueReward()" style="display: block; width: 170px; margin: 20px auto; background-color: #000; border: none; color: white; padding: 12px 24px; text-align: center; text-decoration: none; font-size: 16px; border-radius: 4px; transition: background-color 0.3s;">Issue Reward</button>
        </div>
    `;

    // Check if the element exists before attempting to modify it
    if(reward_PopupElement !== null) {
        reward_PopupElement.innerHTML = demoContent;
    } else {
        console.error('Element with ID "hospitality_reward_popup" not found.');
    }
}

function startReservationContent() {
    // Placeholder content for now
    var demoContent = `
	<div class="content">
    <span class="close-btn" onclick="hideHospitalityRewardPopUp()" style="position: absolute; top: 10px; right: 10px; cursor: pointer; font-size: 24px;">&times;</span>
    <h2>Demo Started</h2>
    <p>More details and interactions...</p>

	<div class="selector-container">
    <select id="rewardSelection">
        <option value="0">Choose Reward</option>
        <option value="1">Taco Tuesday Meal</option>
        <option value="2">Bacardi Drink</option>
        <option value="3">Dinner over $50.00</option>
        <option value="4">Dessert with dinner</option>
    </select>
</div>



    <button onclick="issueReward()" style="display: block; width: 170px; margin: 20px auto; background-color: #000; border: none; color: white; padding: 12px 24px; text-align: center; text-decoration: none; font-size: 16px; border-radius: 4px; transition: background-color 0.3s;">Issue Reward</button>
</div>

    `;

    document.getElementById('hospitalityRewardPopUp').innerHTML = demoContent;
}
function issueReward() {
    let email = sessionStorage.getItem('email');
    let firstName = sessionStorage.getItem('first_name');
    let lastName = sessionStorage.getItem('last_name');
    let company = sessionStorage.getItem('company');
    let accessToken = sessionStorage.getItem('bearerToken');
    let num_choices = parseInt(sessionStorage.getItem('num_choices') || "0");
    
    // Increment choices
    num_choices++;

    // Check if we've reached the maximum number of choices and return if we have
    if(num_choices > 4) {
        console.error('Maximum number of choices reached');
        return;
    }

    // Store the incremented value back into sessionStorage
    sessionStorage.setItem('num_choices', num_choices.toString());
    
    let templateTierId;
    switch (num_choices) {
        case 1:
            templateTierId = 131;
			points = 100;
            break;
        case 2:
            templateTierId = 132;
			points = 200;
            break;
        case 3:
            templateTierId = 133;
			points = 300;
            break;
        case 4:
            templateTierId = 134;
			points = 400;
            break;
        default:
            console.error('Invalid number of choices');
            return;
    }

    let customData = {
        templateTierId: templateTierId,  // Pass templateTierId directly, not as metaData
		passdata: {
            points: points.toString()  // Convert points to string as you have it in string format in the structure
        }
    };

    // Now, call your existing function with the constructed data
    makeIssueWalletApiCall(accessToken, firstName, lastName, email, company, customData, function() {
        console.log("Reward issued successfully.");
    });
}


function showHospitalityMessagePopup() {
    var message_PopupElement = document.getElementById('hospitality_message_popup');
    var overlayElement = document.getElementById('pop_overlay');

    if (message_PopupElement !== null && overlayElement !== null) {
        var formContent =  `
            <div style="background-color: #fff; max-width: 600px; height: 500px; margin: auto; padding: 20px; position: relative; border-radius: 10px; box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5); overflow-y: auto;">
                <span class="close-btn" onclick="hideHospitalityMessagePopUp" style="position: absolute; top: 10px; right: 10px; cursor: pointer; font-size: 24px;">&times;</span>
                <img src="img/hospitality_rewards_slide.png" alt="Hospitality Rewards" style="max-width: 100%; width: auto; height: auto; display: block; margin: 20px auto;">
                <p style="margin: 16px 0;">Some description for the demo...</p>
                <button onclick="startMessagingContent()" style="display: block; width: 170px; margin: 20px auto; background-color: #000; border: none; color: white; padding: 12px 24px; text-align: center; text-decoration: none; font-size: 16px; border-radius: 4px; transition: background-color 0.3s;">Start Demo</button>
            </div>
        `;

        message_PopupElement.innerHTML = formContent;
        message_PopupElement.style.display = 'flex';
        message_PopupElement.style.position = 'fixed';  // Fixed position
        message_PopupElement.style.left = '0';
        message_PopupElement.style.top = '0';
        message_PopupElement.style.justifyContent = 'center';
        message_PopupElement.style.alignItems = 'center';
        message_PopupElement.style.width = '100%';
        message_PopupElement.style.height = '100%';
        message_PopupElement.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
        message_PopupElement.style.zIndex = '1001';
        message_PopupElement.style.overflowY = 'auto';  // Scrollable

        overlayElement.style.display = 'block';  // Show the overlay
    } else {
        console.error('Element with ID "hospitality_message_popup" or "pop_overlay" not found.');
    }
}
function startMessagingContent() {
    const content = `
        <div class="popup-content">
            <span class="close-btn" onclick="closeHospitalityMessagePopup()" style="position: absolute; top: 10px; right: 10px; cursor: pointer; font-size: 24px;">&times;</span>
            <h2>Hospitality Messaging</h2>
            <textarea id="messageTextarea" placeholder="Type your message here..." style="border: 2px solid #000; padding: 10px; width: 100%; box-sizing: border-box; border-radius: 4px;"></textarea>
            <button onclick="hospitality_messaging()" style="display: block; width: 170px; margin: 20px auto; background-color: #000; border: none; color: white; padding: 12px 24px; text-align: center; text-decoration: none; font-size: 16px; border-radius: 4px; transition: background-color 0.3s;">Message</button>
        </div>
    `;

    document.getElementById('hospitality_message_popup').innerHTML = content;
}






function hospitality_messaging() {
    let accessToken = sessionStorage.getItem('bearerToken');

    if (!accessToken) {
        obtainToken(accessToken);  // Assuming this function obtains the token and stores it in the session storage.
        accessToken = sessionStorage.getItem('bearerToken');  // Re-fetch the token after obtaining it.
    }
    
    const email = sessionStorage.getItem('email');
    const message = document.getElementById('messageTextarea').value;

    const data = {
        brandId: 9,
        programId: 265,
        currentMessage: message
    };
    console.log("Constructed request body:", data);
    updateWalletPass(accessToken, email, data, function() {
        console.log("Message sent successfully.");
    });
}


function closeHospitalityMessagePopup() {
    document.getElementById('hospitality_message_popup').style.display = 'none';
    document.getElementById('pop_overlay').style.display = 'none';
}
function updateWalletPass(bearerToken) {
    const emailFromSession = sessionStorage.getItem('email');
    const endpoint = 'https://sandbox.api.bambumeta.software/brands/9/programs/265/wallets?email=' + encodeURIComponent(emailFromSession); // Note the '=' after 'email' was missing.

    const proxiedEndpoint = getProxyURL(endpoint);

    const apiHeaders = {
        Authorization: 'Bearer ' + bearerToken
    };

    const currentMessage = document.getElementById('messageTextarea').value;

    const dataToSend = {
        "brandId": 9,
        "programId": 265,
        "templateId": 180,
        "currentMessage": currentMessage
    };

    $.ajax({
        url: proxiedEndpoint,
        method: 'PATCH',
        headers: apiHeaders,
        data: JSON.stringify(dataToSend),
        contentType: 'application/json',
        success: function(response) {
            console.log('Success handler triggered:', response);
            console.log("Wallet pass updated successfully.");
        },
        error: function(error) {
            console.log('Error handler triggered:', error);
        }
    });
}



// Example usage:
// let data = {
//     person: {
//         firstName: "John",
//         lastName: "Doe"
//     },
//     currentMessage: "This is a test message"
// };
// updateWalletPass(data);
function saveToGoogleSheets(firstName, lastName, email, company, industry, hospitality_loyalty) {
    const zapierWebhookURL = "https://hooks.zapier.com/hooks/catch/9822474/3ionje2/";

    // Get the seller and demo URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const seller = urlParams.get('seller') || '';
    const demo = urlParams.get('demo') || '';

    const dataToSend = {
        firstName: firstName,
        lastName: lastName,
        email: email,
        company: company,
        industry: industry,
        hospitality_loyalty: hospitality_loyalty,
        seller: seller,  // Added seller
        demo: demo  // Added demo
    };

    $.ajax({
        url: zapierWebhookURL,
        method: 'POST',
        data: dataToSend,
        success: function(response) {
            console.log('Data sent to Zapier successfully:', response);
        },
        error: function(error) {
            console.log('Error sending data to Zapier:', error);
        }
    });
}




function showGoogleMapsWidget() {
    const popup = document.getElementById('hospitality_location_popup');
    popup.innerHTML = `
        <!-- Insert your Google Maps Widget or its placeholder here -->
        <div id="googleMapsWidget"></div>
        <button onclick="locateMe()">Locate Me</button>
        <textarea id="locationMessage" placeholder="Set a location message"></textarea>
        <button onclick="updateLocationMessage()">Set</button>
    `;
    // Initialize your Google Maps widget here if needed.
}

function locateMe() {
    // Your logic to locate the user using Google Maps goes here.
}

function updateLocationMessage() {
    const message = document.getElementById('locationMessage').value;
    // Assuming the function `updateWalletPass` has been previously defined and takes the message as its parameter.
    updateWalletPass(message);
}


</script>
<!-- /SCRIPTS -->
<!-- Other HTML content above -->

  </body>
  </html>
